!function(a){function b(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d}function c(a,c,d){var e={distSq:b(c,d),value:d},f=_.sortedIndex(a,e,"distSq");a.splice(f,0,e)}a.Util={override:function(a,b,c){var d=a[b];a[b]=function(){var a=this.__super;this.__super=d;var b=c.apply(this,arguments);return this.__super=a,b}},distanceFrom:function(a,b){var d=[];return function e(f){f instanceof Phaser.Group?b.forEach(e,!0):f&&c(d,a,f)}(b),d},findClosest:function(a,b,c){void 0===c&&(c=1);var d=Util.distanceFrom(a,b),e=_(d).first(c).map(function(a){return{distance:Math.sqrt(a.distSq),value:a.value}}).valueOf();return 1===c?e[0]:e},lobAtPoint:function(a,b,c,d){var e=b.x-a.x,f=b.y-a.y,g=c,h=g*g,i=-d,j=i*e,k=h*h-i*(j*e+2*f*h);if(0>=k)return void 0;var l=Math.sqrt(k),m=Math.atan2(h+l,j)+Math.PI;return a2=Math.atan2(h-l,j)+Math.PI,[m,a2]}}}(this),function(a){function b(a,b,c,d){Phaser.Sprite.call(this,a,0,0,"command-icons"),this.animations.add("selected",[c]),this.animations.add("unselected",[d]),this.animations.play("unselected"),this._selected=!1,this.command=b}function c(a){Phaser.Group.call(this,a),this.icons={move:this.addIcon("move",1,0,Phaser.Keyboard.E),attack:this.addIcon("attack",3,2,Phaser.Keyboard.Q),stop:this.addIcon("stop",6,6),gravityUp:this.addIcon("gravityUp",8,7,Phaser.Keyboard.R),gravityDown:this.addIcon("gravityDown",10,9,Phaser.Keyboard.F)},this.events=new Phaser.Events,_.extend(this.events,{onIconSelected:new Phaser.Signal,onIconDeselected:new Phaser.Signal})}b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,Object.defineProperty(b.prototype,"selected",{get:function(){return this._selected},set:function(a){var b=!!a;b!=this._selected&&(this._selected=b,this.animations.play(this._selected?"selected":"unselected"))}}),c.prototype=Object.create(Phaser.Group.prototype),c.prototype.constructor=c,c.preload=function(a){a.spritesheet("command-icons","assets/command icons.e4aa6814.png",64,64,11)},_.extend(c.prototype,{addIcon:function(a,c,d,e){var f=new b(this.game,a,c,d,e);if(f.inputEnabled=!0,f.events.onInputDown.add(this.onIconClicked,this),f.kill(),void 0!==e){var g=f.accelerator=this.game.input.keyboard.addKey(e);g.onDown.add(function(){this.onIconClicked(f)},this)}return this.add(f),f},display:function(){this.callAll("kill");var a=_.flatten(arguments),b=0;_.each(a,function(a){var c=this.icons[a];c&&c.reset(b,0),b+=96},this)},onIconClicked:function(a){this.selectedIcon&&this.selectedIcon!=a&&(this.events.onIconDeselected.dispatch(this.selectedIcon.command),this.selectedIcon.selected=!1),a.selected?(this.events.onIconDeselected.dispatch(a.command),a.selected=!1,this.selectedIcon=null):(this.events.onIconSelected.dispatch(a.command),a.selected=!0,this.selectedIcon=a)},clearSelection:function(){this.selectedIcon&&(this.events.onIconDeselected.dispatch(this.selectedIcon.command),this.selectedIcon.selected=!1,this.selectedIcon=null)},clear:function(){this.clearSelection(),this.display()}}),a.IconBar=c}(this),function(a){function b(a){Phaser.Group.call(this,a),this.fixedToCamera=!0;var b=a.make.image(710,65,"peasants-icon");b.anchor.setTo(.5,.5);var c=a.make.bitmapText(733,70,"minecraftia","x",16),d=this.text=a.make.bitmapText(746,62,"minecraftia","0",24),e=a.make.image(20,20,"quit-icon");e.scale.x=.5,e.scale.y=.5,e.inputEnabled=!0,e.events.onInputDown.add(this.game.mainMenu,this.game),this.add(b),this.add(c),this.add(d),this.add(e)}b.prototype=Object.create(Phaser.Group.prototype),b.prototype.constructor=b,b.preload=function(a){a.image("peasants-icon","assets/peasants icon.b080a604.png"),a.image("quit-icon","assets/quit icon.59f14e9a.png")},_.extend(b.prototype,{onStateChange:function(a){this.text.text=a.count.peasants+a.pending.peasants}}),a.HUD=b}(this),function(a){function b(a,c,d){Phaser.TileSprite.call(this,a,c,0,8,a.world.height,b.commandToKey[d]),this.anchor.setTo(.5,0)}b.prototype=Object.create(Phaser.TileSprite.prototype),b.prototype.constructor=b,b.commandToKey={move:"command-indicator-green",attack:"command-indicator-red",defend:"command-indicator-blue"},b.preload=function(a){a.image("command-indicator-red","assets/vertical red.b90905c2.png"),a.image("command-indicator-blue","assets/vertical blue.b66fa825.png"),a.image("command-indicator-green","assets/vertical green.916d36c6.png")},a.CommandIndicator=b}(this),function(a){function b(a){this.game=a,this.units=[],this.shiftKey=a.input.keyboard.addKey(Phaser.Keyboard.SHIFT),this.events={onSelectionChange:new Phaser.Signal}}b.prototype={onInputDown:function(a){var b,c,d=this.shiftKey.isDown;a.selected?d||1===this.units.length&&this.units[0]===a?c=this.remove(a):(c=this.remove(_.without(this.units,a)),b=this.add(a)):(d||(c=this.remove(_.without(this.units,a))),b=this.add(a)),this.events.onSelectionChange.dispatch(this.units.slice(),b,c)},onLasso:function(a){var b,c,d=this.shiftKey.isDown;_.isEmpty(a)&&!d?(c=this.remove(this.units),this.events.onSelectionChange.dispatch(this.units.slice(),[],c)):(d?b=this.add(a):(c=this.remove(_.without(this.units,a)),b=this.add(a)),this.events.onSelectionChange.dispatch(this.units.slice(),b,c))},add:function(){var a=[];return _(arguments).flatten().each(function(b){b.selected||(b.selected=!0);var c=this.units.indexOf(b);0>c&&(this.units.push(b),a.push(b),b.events.onKilled.addOnce(this.onKilled,this))},this),a},remove:function(){var a=[];return _(arguments).flatten().each(function(b){b.selected&&(b.selected=!1);var c=this.units.indexOf(b);c>=0&&(this.units.splice(c,1),a.push(b))},this),a},forEach:function(a,b){_.each(this.units,a,b)},onKilled:function(a){var b=this.remove(a);this.events.onSelectionChange.dispatch(this.units.slice(),[],b)},onSpawn:function(a){a instanceof Orc||a.events.onInputDown.add(this.onInputDown,this)}},a.SelectionManager=b}(this),function(a){function b(a,b){this.game=a,this.iconBar=b,this.commands={},this.activeCommand=null,this.events={onStartCommand:new Phaser.Signal,onEndCommand:new Phaser.Signal}}function c(a){return _(a).pluck("commands").flatten().unique().sortBy(function(a){return d[a]||-1}).valueOf()}_.extend(b.prototype,{add:function(a,b){this.commands[a]=b},update:function(){var a=this.activeCommand;a&&a.update()},onSelectionChange:function(a){if(this.selection=a,this.iconBar.clear(),_.isEmpty(a));else{var b=c(a);this.iconBar.display(b)}},onIconSelected:function(a){var b=this.commands[a];b&&(this.events.onStartCommand.dispatch(a),this.activeCommand&&this.activeCommand.cancel(),this.activeCommand=b,b.start(_.once(function(b,c,d){b?console.log(b):_.forEach(this.selection,c,d),this.activeCommand=null,this.iconBar.clearSelection(),this.events.onEndCommand.dispatch(a,b)}.bind(this))))},onIconDeselected:function(a){var b=this.activeCommand;b&&this.commands[a]===b&&(b.cancel(),this.activeCommand=null)}});var d={back:0,move:1,attack:2,defend:3,rally:4,stop:5};a.CommandManager=b}(this),function(a){function b(a,b){this.game=a,this.command=b}b.prototype={start:function(a){this.callback=a;var b=this.indicator=new CommandIndicator(this.game,0,this.command);this.game.add.existing(b),this.game.input.onDown.addOnce(this.onDown,this)},update:function(){this.indicator&&(this.indicator.x=this.game.input.mousePointer.worldX)},cancel:function(){this.destroyIndicator(),this.game.input.onDown.remove(this.onDown,this)},onDown:function(){var a=this.game.input.mousePointer.worldX;this.destroyIndicator(),this.callback(null,function(b){b.send({command:this.command,target:a})},this)},destroyIndicator:function(){this.indicator&&(this.indicator.destroy(),this.indicator=null)}},a.PickXCoordCommand=b}(this),function(a){function b(){}b.prototype={start:function(a){a(null,function(a){a.send({command:"stop"})})}},a.StopCommand=b}(this),function(a){function b(a){Phaser.Sprite.call(this,a,0,0,"invisible"),this.width=a.world.width,this.height=a.world.height,this.inputEnabled=!0,this.fixedToCamera=!0}b.preload=function(a){a.image("invisible","assets/transparent white.befc4a78.png")},b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,a.Backdrop=b}(this),function(a){function b(a,b,c){Phaser.Sprite.call(this,a,b,c,"health-bar"),this.frame=0}b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,b.preload=function(a){a.spritesheet("health-bar","assets/health bar.9bea7ae7.png",32,8)},_.extend(b.prototype,{setHp:function(a,b){var c=a/b;this.frame=.25>=c?3:.5>=c?2:.75>=c?1:0}}),a.HealthBar=b}(this),function(a){function b(a){return function(b){for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];b[c]&&"function"==typeof d?Util.override(b,c,d):b[c]=d}}}a.Mixin={create:b}}(this),function(a){var b={WALK_RATE:6,FALL_RATE:12,DEFAULT_WALK_SPEED:50,DEFAULT_JUMP_SPEED:-220,DEFAULT_GRAVITY:350,init:function(){this.animations.add("stand",[1]),this.animations.add("face-left",[4]),this.animations.add("face-right",[7]),this.animations.add("walk-left",[3,4,5,4],b.WALK_RATE,!0),this.animations.add("walk-right",[6,7,8,7],b.WALK_RATE,!0),this.animations.add("falling",[1,4,10,7],b.FALL_RATE,!0),this.animations.play("stand"),game.physics.enable(this,Phaser.Physics.ARCADE),this.body.setSize(14,32,9,0),this.anchor.setTo(.5,.5),this.body.collideWorldBounds=!0,this.body.acceleration.y=this.DEFAULT_GRAVITY,this.gravityDir=Phaser.DOWN},onFloor:function(){switch(this.gravityDir){case Phaser.DOWN:return this.body.onFloor();case Phaser.UP:return this.body.blocked.up}},updateState:function(){switch(this.state){case"standing":if(this.onFloor()){this.body.velocity.x=0;var a=this.destination();if(void 0!==a){var b=a>this.body.x?Phaser.RIGHT:Phaser.LEFT;this.walk(b)}}else this.fall();break;case"walking":if(this.onFloor()){var c=this.destination();void 0!==c?this.dir==Phaser.LEFT?c>this.x?this.walk(Phaser.RIGHT):this.body.blocked.left?this.jump():(this.body.touching.left||this.body.touching.down)&&this.jump():this.dir==Phaser.RIGHT&&(c<this.x?this.walk(Phaser.LEFT):this.body.blocked.right?this.jump():(this.body.touching.right||this.body.touching.down)&&this.jump()):"none"===this.activity&&this.stand()}else this.fall();break;case"falling":this.onFloor()&&this.stand();break;case"jumping":if(this.gravityDir===Phaser.DOWN&&this.body.velocity.y>0||this.gravityDir===Phaser.UP&&this.body.velocity.y<0)this.fall();else{var c=this.destination();void 0!==c&&(c<this.x?this.left():c>this.y&&this.right())}break;case"cooldown":}},jump:function(){this.changeState("jumping");var a=this.jumpSpeed||b.DEFAULT_JUMP_SPEED;this.body.velocity.y=this.gravityDir===Phaser.DOWN?a:-a},left:function(){this.body.velocity.x=-(this.walkSpeed||b.DEFAULT_WALK_SPEED),this.dir=Phaser.LEFT},right:function(){this.dir=Phaser.RIGHT,this.body.velocity.x=this.walkSpeed||b.DEFAULT_WALK_SPEED},stand:function(){switch(this.changeState("standing"),this.dir){case Phaser.LEFT:this.animations.play("face-left");break;case Phaser.RIGHT:this.animations.play("face-right");break;default:this.animations.play("stand")}},fall:function(){this.changeState("falling")},walk:function(a){switch(a){case Phaser.LEFT:this.changeState("walking"),this.animations.play("walk-left"),this.left();break;case Phaser.RIGHT:this.changeState("walking"),this.animations.play("walk-right"),this.right()}},changeGravity:function(a){this.gravityDir!=a&&(this.gravityDir=a,this.game.time.events.add(300,function(){this.body.acceleration.y=a===Phaser.DOWN?this.DEFAULT_GRAVITY:-this.DEFAULT_GRAVITY,this.scale.y=-this.scale.y},this))},changeState:function(a){this.prevState=this.state,a!=this.state&&(this.onExitState&&this.onExitState(this.state),this.onEnterState&&this.onEnterState(a)),this.state=a},changeActivity:function(a){this.prevActivity=this.activity,a!==this.activity&&(this.onStopActivity&&this.onStopActivity(a),this.onStartActivity&&this.onStartActivity(a)),this.activity=a}};a.Mixin.humanoid=Mixin.create(b)}(this),function(a){function b(a,b,c,d){Phaser.Sprite.call(this,a,b,c,d)}b.preload=function(a){a.image("1x1-select-box","assets/1x1 selected.fef6b915.png")},b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,_.extend(b.prototype,{createSelectBox:function(){var a=this.selectBox=game.make.sprite(0,0,"1x1-select-box");a.anchor.setTo(.5,.5),a.smoothed=!1,a.visible=!1,this.addChild(a)},createHealthBar:function(){var a=this.height/2,b=this.healthBar=new HealthBar(this.game,0,-a);b.anchor.setTo(.5,1),b.smoothed=!1,b.visible=!1,this.addChild(b)},setHp:function(a,b){void 0!==b&&(this.maxHp=Math.max(1,b)),this.currHp=Math.min(a||0,this.maxHp),this.healthBar.setHp(this.currHp,this.maxHp)},send:function(a){this.onMessage&&this.onMessage(a)},onMessage:function(a){console.log(a)}}),Object.defineProperty(b.prototype,"selected",{get:function(){return this.selectBox.visible},set:function(a){return this.healthBar.visible=this.selectBox.visible=!!a}}),a.Unit=b}(this),function(a){function b(a,b,c,d,e){Unit.call(this,a,b,c,d),this.init(),this.inputEnabled=!0,this.createSelectBox(32,32),this.createHealthBar(),this.activity="none",this.dir=Phaser.NONE,this.blood=e,this.fall()}b.SEEK_TOLERANCE=4,b.WAIT_TOLERANCE=24,b.CLOSE_ENOUGH_X=300,b.CLOSE_ENOUGH_Y=96,b.TOO_FAR_X=400,b.WITHIN_ATTACK_RANGE=24,b.ARROW_SPEED=350,b.ARROW_GRAVITY=450,b.ATTACK_DAMAGE=20,b.TO_HIT_TIME=200,b.COOLDOWN_TIME=1300,b.prototype=Object.create(Unit.prototype),b.prototype.constructor=b,Mixin.humanoid(b.prototype),_.extend(b.prototype,{think:function(){switch(this.activity){case"seeking":Math.abs(this.x-this.target)<b.SEEK_TOLERANCE&&(this.dir=Phaser.NONE,this.changeActivity("none"),this.stand());break;case"waiting":case"patrolling":"waiting"!==this.activity&&Math.abs(this.x-this.target)<(this.seekTolerance||b.SEEK_TOLERANCE)?(this.dir=Phaser.NONE,this.changeActivity("waiting"),this.stand()):"patrolling"!==this.activity&&Math.abs(this.x-this.target)>(this.waitTolerance||b.WAIT_TOLERANCE)&&this.changeActivity("patrolling");var a=this.foes;if(a){var c=Util.findClosest(this,a);c&&(this.actualClosest=c,this.closeEnough(c.value)&&!this.outOfReach(c.value)&&(this.prey=c.value,this.changeActivity("attacking")))}break;case"attacking":this.prey&&(this.prey.exists?this.tooFar(this.prey)?(this.changeActivity("patrolling"),this.stand()):this.onFloor()&&this.withinRange(this.prey)&&this.attack(this.prey):(this.prey=null,this.changeActivity("patrolling")))}this.updateState()},destination:function(){switch(this.activity){case"patrolling":case"seeking":return this.target;case"attacking":return this.prey.x}},closeEnough:function(a){var c=this.closeEnoughX||b.CLOSE_ENOUGH_X,d=this.closeEnoughY||b.CLOSE_ENOUGH_Y;return Math.abs(this.x-a.x)<=c&&Math.abs(this.y-a.y)<=d},tooFar:function(a){var c=this.tooFarX||b.TOO_FAR_X,d=this.closeEnoughY||b.CLOSE_ENOUGH_Y,e=Math.abs(this.x-a.x),f=Math.abs(this.y-a.y);return this.outOfReach(a)||e>=c&&f>=d},outOfReach:function(a){var c=Math.abs(this.x-a.x),d=Math.abs(this.y-a.y);return c<=b.SEEK_TOLERANCE+2&&d>=16},withinRange:function(a){var c=this.withinAttackRange||b.WITHIN_ATTACK_RANGE;return Math.abs(a.x-this.x)<=c&&Math.abs(a.y-this.y)<=2},attack:function(){this.nextActivity="patrolling",this.cooldown(b.COOLDOWN_TIME)},cooldown:function(a){this.changeActivity("cooling down"),this.stand(),this.game.time.events.add(a,this.wakeUp,this)},wakeUp:function(){"cooling down"===this.activity&&this.changeActivity(this.nextActivity||"none")},patrol:function(a){this.target=a,this.activity="patrolling"},damage:function(a){if(this.exists){this.currHp-=a,this.healthBar.setHp(this.currHp,this.maxHp);var b=this.x,c=this.y;this.currHp<=0?(this.blood.gush(b,c),this.kill(),this.destroy()):this.blood.spray(b,c)}},seek:function(a){this.target=a,this.changeActivity("seeking")},stop:function(){this.changeActivity("none"),this.dir=Phaser.NONE,this.target=null},onMessage:function(a){if(_.contains(this.commands,a.command))switch(a.command){case"move":this.seek(a.target);break;case"attack":this.patrol(a.target);break;case"stop":this.stop()}}}),Object.defineProperty(b.prototype,"team",{value:"human"}),a.Troop=b}(this),function(a){function b(a,c,d,e){Troop.call(this,a,c,d,"knight",e),this.commands=b.COMMANDS,this.setHp(200,200),this.healCount=0}b.prototype=Object.create(Troop.prototype),b.prototype.constructor=b,b.COMMANDS=["attack","move","stop"],b.TO_HIT_TIME=200,b.ATTACK_DAMAGE=10,b.COOLDOWN_TIME=600,b.preload=function(a){a.spritesheet("knight","assets/knight.5f1d77ac.png",32,32)},_.extend(b.prototype,{attack:function(a){var c=a.x,d=a.y;this.x<c?(this.dir=Phaser.RIGHT,this.animations.play("face-right")):this.x>c&&(this.dir=Phaser.LEFT,this.animations.play("face-left"));var e=new SlashEffect(this.game,c,d,this.dir);this.game.add.existing(e),this.game.time.events.add(b.TO_HIT_TIME,function(){this.prey.damage(b.ATTACK_DAMAGE)},this),this.nextActivity="patrolling",this.cooldown(b.COOLDOWN_TIME)},update:function(){this.healCount+=1,this.healCount>=35&&(this.healCount=0,this.setHp(this.currHp+10))}}),a.Soldier=b}(this),function(a){function b(a,b,c,d){this.attackDamage=d||Archer.ATTACK_DAMAGE,Phaser.Sprite.call(this,a,b,c,"arrow"),this.anchor.setTo(.5,.5),a.physics.enable(this,Phaser.Physics.ARCADE),this.body.setSize(16,5,0,5),this.body.collideWorldBounds=!0,this.body.bounce.set(.3)}b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,b.FADE_TIME=2500,Util.override(b.prototype,"reset",function(a,b){this.__super(a,b),this.body.collideWorldBounds=!0,this.outOfBoundsKill=!1,this.checkOutOfBounds=!1,this.ghosted=!1;for(var c in this.body.checkCollision)this.body.checkCollision[c]=!0}),b.preload=function(a){a.image("arrow","assets/arrow.45d3f1a7.png")},b.processWorld=function(a){return!a.ghosted},b.collideWorld=function(a){a.ghosted=!0,a.outOfBoundsKill=!0,a.checkOutOfBounds=!0;for(var b in a.body.checkCollision)a.body.checkCollision[b]=!1},b.collideOrc=function(a,b){b.damage(a.attackDamage),a.kill()},_.extend(b.prototype,{update:function(){var a=this.body.velocity;this.rotation=Math.atan2(a.y,a.x)}}),a.Arrow=b}(this),function(a){function b(a,b){void 0===b&&(b=100),Phaser.Group.call(this,a);for(var c=0;b>c;c++){var d=new Arrow(a,0,0);this.add(d),d.kill()}}b.prototype=Object.create(Phaser.Group.prototype),b.prototype.constructor=b,_.extend(b.prototype,{getArrow:function(a,b){var c=this.getFirstDead();return c.reset(a,b),c}}),a.ArrowGroup=b}(this),function(a){function b(a,c,d,e){Troop.call(this,a,c,d,"archer",e),this.commands=b.COMMANDS,this.setHp(75,75),this.withinAttackRange=b.WITHIN_ATTACK_RANGE,this.cooldownTime=b.COOLDOWN_TIME}b.prototype=Object.create(Troop.prototype),b.prototype.constructor=b,b.COMMANDS=["attack","move","stop"],b.WITHIN_ATTACK_RANGE=200,b.ARROW_SPEED=350,b.ARROW_GRAVITY=450,b.ATTACK_DAMAGE=20,b.COOLDOWN_TIME=1300,b.preload=function(a){a.spritesheet("archer","assets/archer.64e4bc6f.png",32,32)},Mixin.create({attack:function(a){{var c=this.game,d=a.x;a.y}this.x<d?(this.dir=Phaser.RIGHT,this.animations.play("face-right")):this.x>d&&(this.dir=Phaser.LEFT,this.animations.play("face-left"));var e=Util.lobAtPoint(this,a,b.ARROW_SPEED,b.ARROW_GRAVITY);if(void 0!==e){var f=this.arrows.getArrow(this.x,this.y);f.body.acceleration.y=b.ARROW_GRAVITY,e=c.rnd.pick(e),c.physics.arcade.velocityFromRotation(e,b.ARROW_SPEED,f.body.velocity)}this.nextActivity="patrolling",this.cooldown(b.COOLDOWN_TIME)},withinRange:function(a){var b=this.withinAttackRange||Troop.WITHIN_ATTACK_RANGE;return Phaser.Point.distance(this,a)<=b},outOfReach:function(a){return!this.withinRange(a)},onMessage:function(a){switch(a.command){case"move":this.seek(a.target);break;case"attack":this.patrol(a.target);break;case"stop":this.stop()}}})(b.prototype),a.Archer=b}(this),function(a){function b(a,c,d,e){Troop.call(this,a,c,d,"peasant",e),this.commands=b.COMMANDS,this.setHp(40,40)}b.prototype=Object.create(Troop.prototype),b.prototype.constructor=b,b.COMMANDS=["move","stop"],b.preload=function(a){a.spritesheet("peasant","assets/peasant.4599a146.png",32,32)},a.Peasant=b}(this),function(a){function b(a,b,c,d){this.dir=d,Phaser.Sprite.call(this,a,b,c,"spell-arrow"),this.anchor.setTo(.5,1),a.physics.enable(this,Phaser.Physics.ARCADE),this.animations.add("flutter",[0,1],8)}function c(a){Phaser.Group.call(this,a);for(var c=0;100>c;c++){var d=new b(this.game,0,0,Phaser.NONE);this.add(d),d.kill()}}b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,b.GRAVITY=200,_.extend(b.prototype,{init:function(){var a=this.game.rnd,c=a.realInRange(.25,1);this.scale.x=c,this.scale.y=c,this.dir===Phaser.DOWN?(this.scale.y*=-1,this.body.acceleration.y=b.GRAVITY):this.body.acceleration.y=-b.GRAVITY,this.animations.play("flutter"),this.alpha=0,this.game.add.tween(this).to({alpha:.6},300).to({alpha:.6},1e3).to({alpha:0},150).start(),this.game.time.events.add(1450,this.kill,this)}}),Util.override(b.prototype,"reset",function(a,b){this.__super(a,b),this.init()}),c.prototype=Object.create(Phaser.Group.prototype),c.prototype.constructor=c,c.preload=function(a){a.spritesheet("spell-arrow","assets/spell arrows.369fa48f.png",32,64)},_.extend(c.prototype,{nextArrow:function(a,b,c){var d=this.getFirstDead();return d.dir=c,d.reset(a,b),d}}),a.GravityEffect=c}(this),function(a){function b(a,c,d,e){Phaser.Sprite.call(this,a,c,d,"gravity-field"),this.game=a,this.dir=e,this.game.physics.enable(this,Phaser.Physics.ARCADE),this.anchor.setTo(.5,.5),this.alpha=.6,a.add.tween(this).to({alpha:.2},500,null,!0,0,Number.MAX_VALUE,!0),a.time.events.add(b.DURATION,this.destroy,this)}b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,b.DURATION=3e3,b.preload=function(a){a.image("gravity-field","assets/gravity field.fa3fca9a.png")},b.changeGravity=function(a,b){b.changeGravity(a.dir)},_.extend(b.prototype,{spawn:function(){if(this.exists){var a=this.game.rnd,b=this.width/2,c=a.realInRange(this.x-b,this.x+b),d=this.height/2,e=this.dir===Phaser.UP?this.y+32:this.y-32,f=a.realInRange(e-d,e+d),g=a.integerInRange(50,300);this.effect.nextArrow(c,f,this.dir),this.game.time.events.add(g,this.spawn,this)}}}),a.GravityField=b}(this),function(a){function b(a,b){this.game=a,this.gravityDir=b||Phaser.UP}b.prototype={start:function(a){this.callback=a,this.game.input.onDown.addOnce(this.onDown,this)},update:function(){},cancel:function(){this.game.input.onDown.remove(this.onDown,this)},onDown:function(){var a=this.game.input.mousePointer,b=a.worldX,c=a.worldY;this.callback(null,function(a){a.send({command:"change-gravity",dir:this.gravityDir,target:{x:b,y:c}})},this)}},a.GravitySpellCommand=b}(this),function(a){function b(a,c,d,e){Troop.call(this,a,c,d,"priest",e),this.commands=b.COMMANDS,this.setHp(90,90),this.walkSpeed=90,this.castTarget=new Phaser.Point,this.castTarget.setTo(-1,-1)}b.prototype=Object.create(Troop.prototype),b.prototype.constructor=b,b.COMMANDS=["gravityUp","gravityDown","move","stop"],b.MIN_CAST_DISTANCE=200,b.preload=function(a){a.spritesheet("priest","assets/priest.c6c2ddb0.png",32,32)},Mixin.create({think:function(){switch(this.activity){case"casting":if(this.castTarget.distance(this)<=b.MIN_CAST_DISTANCE){var a=this.castTarget.x,c=this.castTarget.y;this.cast(a,c)}}this.__super()},destination:function(){return"casting"===this.activity?this.castTarget.x:this.__super()},cast:function(a,b){var c=new GravityField(this.game,a,b,this.spellDir);c.effect=this.gravityEffect,c.spawn(),this.spellsGroup.add(c),this.changeActivity("none"),this.stand()},send:function(a){return"change-gravity"!==a.command?this.__super(a):(this.spellDir=a.dir,this.castTarget.copyFrom(a.target),this.changeActivity("casting"),void 0)}})(b.prototype),a.Priest=b}(this),function(a){function b(a,c,d,e){var f=e===b.MALE?"male-orc":"female-orc";Phaser.Sprite.call(this,a,c,d,f),this.setHp(100,100),this.init(),this.activity="none",this.state="none",this.walkSpeed=60,this.fall()}b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,b.MALE="male",b.FEMALE="female",b.CLOSE_ENOUGH_X=200,b.CLOSE_ENOUGH_Y=96,b.TOO_FAR_X=400,b.WITHIN_ATTACK_RANGE=24,b.ATTACK_DAMAGE=40,b.COOLDOWN_TIME=1e3,b.TO_HIT_TIME=200,b.preload=function(a){a.spritesheet("male-orc","assets/gentleman orc.cb00031e.png",32,32),a.spritesheet("female-orc","assets/lady orc.23c865c5.png",32,32)},Mixin.humanoid(b.prototype),_.extend(b.prototype,{setHp:function(a,b){void 0!==b&&(this.maxHp=Math.max(1,b)),this.currHp=Math.min(this.maxHp,a)},think:function(){var a=this.foes;if(a&&"cooling down"!==this.activity){var b=Util.findClosest(this,a);b&&(this.actualClosest=b,this.closeEnough(b.value)&&"hunting"!==this.activity&&(this.prey=b.value,this.changeActivity("hunting")))}switch(this.activity){case"hunting":this.prey?this.prey.exists?this.tooFar(this.prey)?(this.changeActivity("none"),this.stand()):this.onFloor()&&this.withinRange(this.prey)&&this.attack():(this.prey=null,this.changeActivity("none")):(console.log("error: hunting nothing"),this.changeActivity("none"))}this.updateState()},destination:function(){if("hunting"===this.activity){if(this.prey)return this.prey.x;this.changeActivity("none"),console.log("error: hunting nothing")}return void 0},closeEnough:function(a){return Math.abs(this.x-a.x)<=b.CLOSE_ENOUGH_X&&Math.abs(this.y-a.y)<=b.CLOSE_ENOUGH_Y},tooFar:function(a){var c=Math.abs(this.x-a.x),d=Math.abs(this.y-a.y);return c<=Troop.SEEK_TOLERANCE&&d>=16||c>=b.TOO_FAR_X&&d>=b.CLOSE_ENOUGH_Y},withinRange:function(a){return Math.abs(a.x-this.x)<=b.WITHIN_ATTACK_RANGE&&Math.abs(a.y-this.y)<=2},attack:function(){if(this.prey){var a=this.prey.x,c=this.prey.y;this.x<a?(this.dir=Phaser.RIGHT,this.animations.play("face-right")):this.x>a&&(this.dir=Phaser.LEFT,this.animations.play("face-left"));var d=new SlashEffect(this.game,a,c,this.dir);this.game.add.existing(d),this.game.time.events.add(b.TO_HIT_TIME,function(){this.prey.damage(b.ATTACK_DAMAGE)},this),this.cooldown(b.COOLDOWN_TIME)}else this.changeActivity("none"),console.log("error: attacking nothing")},cooldown:function(a){this.changeActivity("cooling down"),this.stand(),this.game.time.events.add(a,this.wakeUp,this)},wakeUp:function(){"cooling down"===this.activity&&this.changeActivity("none")},damage:function(a){if(this.exists){this.currHp-=a;var b=this.x,c=this.y;this.currHp<=0?(this.blood.gush(b,c),this.kill(),this.destroy()):this.blood.spray(b,c)}}}),Object.defineProperty(b.prototype,"team",{value:"orc"}),a.Orc=b}(this),function(a){function b(a,b){var c=this.emitter=a.add.emitter(0,0,100);c.makeParticles(b),c.gravity=350}b.preload=function(a){a.image("man-blood","assets/manblood.24438e51.png"),a.image("orc-blood","assets/orcblood.5fd1d11b.png")},b.prototype={gush:function(a,b){this.emit(a,b,30)},spray:function(a,b){this.emit(a,b,6)},emit:function(a,b,c){var d=this.emitter;d.x=a,d.y=b,d.start(!0,500,null,c)}},a.BloodSpray=b}(this),function(a){function b(a,b,c,d){Phaser.Sprite.call(this,a,b,c,"slash-effect"),this.anchor.setTo(.5,.5),d===Phaser.RIGHT&&(this.scale.x=-1),this.animations.add("slash",[0,1,2,3],10),this.animations.play("slash",null,!1,!0)}b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,b.preload=function(a){a.spritesheet("slash-effect","assets/slash.961ea3bd.png",32,32)},a.SlashEffect=b}(this),function(a){function b(a,c){this.game=a,this.terrain=c,this.units=[];var d=c.width,e=c.height,f=this.fogMap=a.add.tilemap();f.addTilesetImage("fog-of-war-tiles");for(var g=(this.fogLayer=f.create("fog",d,e,32,32),0);d>g;g++)for(var h=0;e>h;h++)f.putTile(b.DARK_TILE,g,h)}b.preload=function(a){a.image("fog-of-war-tiles","assets/fog of war tiles.e1f5b010.png")},b.DARK_TILE=11,b.TRANSPARENT_TILE=12,b.DEFAULT_SIGHT_RANGE=200,b.prototype={attach:function(){this.game.world.bringToTop(this.fogMap)},reveal:function(a,c){var d=this.fogLayer,e=d.getTileX(a.x),f=d.getTileY(a.y),g=c||b.DEFAULT_SIGHT_RANGE;this.setVisible(e,f,g,!0)},track:function(a){if(_.findIndex(this.units,{unit:a})<0){var c=this.fogLayer,d={x:c.getTileX(a.x),y:c.getTileY(a.y),r:a.sightRange||b.DEFAULT_SIGHT_RANGE,unit:a};a.events.onKilled.addOnce(this.onKilled,this),this.setVisible(d.x,d.y,d.r,!0),this.units.push(d)}},update:function(){var a,c,d,e=this.fogLayer;_.forEach(this.units,function(f){a=e.getTileX(f.unit.x),c=e.getTileY(f.unit.y),d=f.unit.sightRange||b.DEFAULT_SIGHT_RANGE,(a!==f.x||c!==f.y||d!==f.r)&&(this.setVisible(f.x,f.y,f.r,!1),this.setVisible(a,c,d,!0),f.x=a,f.y=c,f.r=d)},this)},setVisible:function(a,b,c,d){var e,f,g,h,i,j=this.fogMap,k=this.fogLayer,l=k.getTileX(32*a+c)-a,m=a-l,n=b-l,o=a+l,p=b+l;for(e=m;o>=e;e++)for(f=n;p>=f;f++)e>=0&&e<j.width&&f>=0&&f<j.height&&(g=e-a,h=f-b,i=Math.sqrt(g*g+h*h),l>=i&&(d?this.addLight(e,f):this.removeLight(e,f)))},addLight:function(a,c){var d=this.fogMap,e=this.fogLayer,f=d.getTile(a,c);void 0===f.lights||f.lights<=0?(f.index=b.TRANSPARENT_TILE,f.lights=1,e.dirty=!0):f.lights++},removeLight:function(a,b){var c=this.fogMap,d=this.fogLayer,e=c.getTile(a,b);if(e.lights&&(e.lights--,e.lights<=0)){var f=this.terrain.getTile(a,b);e.index=f?f.index-1:0,d.dirty=!0}},onKilled:function(a){var b=this.units,c=_.findIndex(b,{unit:a}),d=b[c];this.setVisible(d.x,d.y,d.r,!1),this.units.splice(c,1)}},a.FogOfWar=b}(this),function(a){function b(a,b,c,d,e,f,g){Phaser.Sprite.call(this,a,b,c,"hut"),this.anchor.setTo(.5,.5),this.units=g||[],this.humans=d,this.fog=e,this.spawn=f,this.revealed=!1}b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,b.ACTIVATION_RADIUS=80,b.preload=function(a){a.image("hut","assets/hut.f6c2948b.png")},_.extend(b.prototype,{update:function(){if(!this.revealed){var a=Util.findClosest(this,this.humans);a&&a.distance<=b.ACTIVATION_RADIUS&&(this.fog.reveal(this),this.revealed=!0,this.game.time.events.add(500,function(){for(var a,b,c,d=this.units.length,e=this.spawn,f=Math.ceil(d/2),g=this.x-16*f,h=0;d>h;h++){switch(a=g+32*h,b=this.y,this.units[h]){case"priest":c=e.priest(a,b,!0);break;case"soldier":c=e.soldier(a,b,!0);break;case"archer":c=e.archer(a,b,!0);break;case"peasant":c=e.peasant(a,b,!0);break;case"orc":c=e.orc(a,b,!0)}"human"===c.team&&this.fog.track(c)}},this))}}}),a.Hut=b}(this),function(a){function b(a,b){Phaser.Sprite.call(this,a,0,0,"lasso"),this.units=b,this.events.onLasso=new Phaser.Signal,a.physics.enable(this,Phaser.Physics.ARCADE),this.lassoing=!1,this.bubble=!0,this.changeBubble=!1,this.alpha=.6,this.visible=!1,this.startPos=new Phaser.Point}b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,b.preload=function(a){a.image("lasso","assets/lasso.b659d9e1.png")},_.extend(b.prototype,{update:function(){if(this.changeBubble&&(this.bubble=!this.bubble,this.changeBubble=!1),this.lassoing){var a=this.game.input.activePointer,b=a.worldX,c=a.worldY,d=this.startPos.x,e=this.startPos.y;d>b?(this.x=b,this.width=d-b):(this.x=d,this.width=b-d),e>c?(this.y=c,this.height=e-c):(this.y=e,this.height=c-e)}},onInputDown:function(a,b){this.bubble&&(this.visible=!0,this.lassoing=!0,this.startPos.setTo(b.worldX,b.worldY))},onInputUp:function(){if(this.lassoing){var a=[];this.game.physics.arcade.overlap(this,this.units,function(b,c){a.push(c)},null,this),this.events.onLasso.dispatch(a),this.lassoing=!1,this.visible=!1}},onStartCommand:function(){this.bubble=!1},onEndCommand:function(){this.changeBubble=!0}}),a.Lasso=b}(this),function(a){function b(){this.state={count:{peasants:0,humans:0,orcs:0},pending:{peasants:0,humans:0,orcs:0},score:{kills:0,deaths:0,rescued:{soldiers:0,archers:0,peasants:0,priests:0}}},this.dirty=!1,this.events={onStateChange:new Phaser.Signal,onVictory:new Phaser.Signal,onDefeat:new Phaser.Signal}}b.prototype={update:function(){this.dirty&&(this.events.onStateChange.dispatch(this.state),this.dirty=!1,this.state.count.humans<=0?this.events.onDefeat.dispatch():this.state.count.orcs<=0&&this.events.onVictory.dispatch(this.state.count.peasants))},onSpawn:function(a){a instanceof Peasant&&(this.state.count.peasants++,a.events.onKilled.addOnce(this.onPeasantKilled,this)),"orc"===a.team?(this.state.count.orcs++,a.events.onKilled.addOnce(this.onOrcKilled,this)):"human"===a.team&&(this.state.count.humans++,a.events.onKilled.addOnce(this.onHumanKilled,this)),this.dirty=!0},onPeasantKilled:function(){this.state.count.peasants--,this.dirty=!0},onHumanKilled:function(){this.state.count.humans--,this.state.score.deaths++,this.dirty=!0
},onOrcKilled:function(){this.state.count.orcs--,this.state.score.kills++,this.dirty=!0}},a.GameRules=b}(this),function(a){function b(a,b,c,d,e,f,g){this.game=a,this.humans=b,this.orcs=c,this.huts=g,this.manblood=new BloodSpray(a,"man-blood"),this.orcblood=new BloodSpray(a,"orc-blood"),this.arrows=d,this.spells=e,this.gravityEffect=f,this.events={onSpawn:new Phaser.Signal}}function c(a){return 32*a+16}function d(a){return 32*a+16}b.prototype={soldier:function(a,b,e){var f=e?a:d(a),g=e?b:c(b),h=new Soldier(this.game,f,g,this.manblood);return h.foes=this.orcs,this.humans.add(h),this.events.onSpawn.dispatch(h),h},archer:function(a,b,e){var f=e?a:d(a),g=e?b:c(b),h=new Archer(this.game,f,g,this.manblood);return h.foes=this.orcs,h.arrows=this.arrows,this.humans.add(h),this.events.onSpawn.dispatch(h),h},peasant:function(a,b,e){var f=e?a:d(a),g=e?b:c(b),h=new Peasant(this.game,f,g,this.manblood);return this.events.onSpawn.dispatch(h),this.humans.add(h),h},priest:function(a,b,e){var f=e?a:d(a),g=e?b:c(b),h=new Priest(this.game,f,g,this.manblood);return h.gravityEffect=this.gravityEffect,h.spellsGroup=this.spells,this.humans.add(h),this.events.onSpawn.dispatch(h),h},orc:function(a,b,e){var f=e?a:d(a),g=e?b:c(b),h=this.game.rnd.pick(["male","female"]),i=new Orc(this.game,f,g,h);return i.foes=this.humans,i.blood=this.orcblood,this.orcs.add(i),this.events.onSpawn.dispatch(i),i},hut:function(a,b,e){var a=d(a),b=c(b),f=new Hut(this.game,a,b+16,this.humans,this.fog,this,e);return this.huts.add(f),f},orcParty:function(a,b){var a=d(a),b=c(b);this.orc(a-16,b,!0),this.game.math.chanceRoll(10)&&this.orc(a,b,!0),this.orc(a+16,b,!0)}},a.Spawn=b}(this),function(a){function b(){}b.preload=function(a){a.image("black","assets/black.5fb519d0.png")},b.prototype={fader:function(){var a=this.game,b=a.add.sprite(0,0,"black");return b.width=a.width,b.height=a.height,b.fixedToCamera=!0,a.world.bringToTop(b),b},fadeIn:function(a,b){var c=this.game,d=this.fader(),e=c.add.tween(d).to({alpha:0},a,null,!0,b);return{onComplete:e.onComplete}},fadeOut:function(a,b){var c=this.game,d=this.fader(),e=c.add.tween(d).to({alpha:1},a).to({alpha:1},b||0);return d.alpha=0,e.start(),{onComplete:e.onComplete}}},a.FadingState=b}(this),function(a){function b(){}b.prototype={preload:function(){this.load.image("loading-bar-overlay","assets/loading-bar-overlay.ceb049f0.png"),this.load.image("loading-bar","assets/loading-bar.defc2430.png")},create:function(){this.game.state.start("preloader")}},a.Boot=b}(this),function(a){function b(){}b.FADE_OUT_TIME=250,b.STAY_DARK_TIME=100,b.prototype={preload:function(){var a=this.load,b=this.add;this.bar=b.sprite(303,281,"loading-bar"),this.overlay=b.sprite(298,276,"loading-bar-overlay"),a.onLoadComplete.addOnce(this.onLoadComplete,this),a.setPreloadSprite(this.bar),Unit.preload(a),Soldier.preload(a),Archer.preload(a),Peasant.preload(a),Priest.preload(a),Orc.preload(a),IconBar.preload(a),CommandIndicator.preload(a),Backdrop.preload(a),HealthBar.preload(a),BloodSpray.preload(a),SlashEffect.preload(a),Arrow.preload(a),GravityField.preload(a),GravityEffect.preload(a),FogOfWar.preload(a),Lasso.preload(a),HUD.preload(a),FadingState.preload(a),MainMenu.preload(a),Mission.preload(a),Hut.preload(a),this.load.bitmapFont("minecraftia","assets/minecraftia.d0c5b06a.png","assets/minecraftia.ddf29ec1.xml")},onLoadComplete:function(){this.add.tween(this.bar).to({alpha:0},b.FADE_OUT_TIME).start().onComplete.addOnce(function(){this.time.events.add(b.STAY_DARK_TIME,this.game.mainMenu,this.game)},this),this.add.tween(this.overlay).to({alpha:0},b.FADE_OUT_TIME).start()}},a.Preloader=b}(this),function(a){function b(){FadingState.call(this)}b.prototype=Object.create(FadingState.prototype),b.prototype.constructor=b,b.preload=function(a){a.image("title","assets/title.44e33cee.png")},_.extend(b.prototype,{create:function(){var a=this.add.image(400,-300,"title");a.anchor.setTo(.5,.5),this.game.add.tween(a).to({y:250},3200,Phaser.Easing.Bounce.Out,!0);var b=this.game.add.bitmapText(325,425,"minecraftia","Click to Continue",16);b.alpha=0,this.ready=!1,this.clicked=!1,this.input.onDown.add(function(){this.clicked=!0,b.destroy()},this),this.fadeIn(2e3,350).onComplete.add(function(){this.ready=!0},this),this.stage.backgroundColor="#6495ED",b.alpha=1},update:function(){this.clicked&&this.ready&&(this.clicked=!1,this.fadeOut(600).onComplete.addOnce(this.game.nextMission,this.game))}}),a.MainMenu=b}(this),function(a){function b(){FadingState.call(this)}b.prototype=Object.create(FadingState.prototype),b.prototype.constructor=b,b.preload=function(a){a.image("placeholder-tiles","assets/placeholder tiles.2c479a50.png"),a.tilemap("test-map-0","assets/test-map-1.6b80c2ce.json",void 0,Phaser.Tilemap.TILED_JSON)},_.extend(b.prototype,{SCROLL_MARGIN:50,CAMERA_SPEED:10,FADE_IN_DURATION:2500,FADE_OUT_DURATION:1500,FADE_OUT_DELAY:200,init:function(a){this.terrainKey=a||"test-map-0"},create:function(){var a=this.add,b=this.game,c=this.game.physics,d=this.game.input.keyboard;this.stage.backgroundColor="#6495ED",c.startSystem(Phaser.Physics.ARCADE);var e=this.backdrop=new Backdrop(b);b.add.existing(e);var f=this.map=a.tilemap(this.terrainKey),g=this.layer=f.createLayer("terrain");f.addTilesetImage("terrain","placeholder-tiles"),f.setCollisionBetween(2,10,!0),g.resizeWorld();var h=this.iconBar=new IconBar(b);h.x=this.SCROLL_MARGIN,h.y=600-(this.SCROLL_MARGIN+64),h.fixedToCamera=!0;var i=this.selections=new SelectionManager(b),j=this.commands=new CommandManager(b,h);j.add("move",new PickXCoordCommand(b,"move")),j.add("attack",new PickXCoordCommand(b,"attack")),j.add("defend",new PickXCoordCommand(b,"defend")),j.add("stop",new StopCommand),j.add("gravityUp",new GravitySpellCommand(b,Phaser.UP)),j.add("gravityDown",new GravitySpellCommand(b,Phaser.DOWN)),i.events.onSelectionChange.add(j.onSelectionChange,j),h.events.onIconSelected.add(j.onIconSelected,j),h.events.onIconDeselected.add(j.onIconDeselected,j);var k=this.arrows=new ArrowGroup(b),l=this.gravityEffect=new GravityEffect(b),m=this.spells=b.make.group(),n=a.group(),o=this.humans=a.group(),p=this.orcs=a.group();spawn=new Spawn(b,o,p,k,m,l,n);var q=this.rules=new GameRules(b);q.events.onVictory.add(this.onVictory,this),q.events.onDefeat.add(this.onDefeat,this),spawn.events.onSpawn.add(q.onSpawn,q),spawn.events.onSpawn.add(i.onSpawn,i);var r=this.Hud=new HUD(b);q.events.onStateChange.add(r.onStateChange,r);var s=this.fog=new FogOfWar(b,f);spawn.fog=s,residents=[["peasant","peasant","orc"],["peasant","peasant"],["archer","archer","soldier"],["peasant","priest","soldier"],["soldier","soldier","soldier"],["archer","archer","archer"],["peasant","peasant","priest"],["peasant","archer","soldier"],["peasant","archer","soldier"],["soldier","archer"],["priest","priest"],["peasant","peasant","peasant","peasant"],["soldier","soldier","soldier"],["archer","archer"],["archer","archer"],["orc","orc"],["orc","orc"],["orc","orc","orc"],["priest","peasant"]];var t=function(){var a=b.rnd.integerInRange(0,residents.length),c=residents[a];return residents.splice(a,1),c||[]};spawn.hut(46,29,["peasant","soldier","archer"]),spawn.hut(9,8,t()),spawn.hut(12,8,t()),spawn.hut(9,33,t()),spawn.hut(39,22,t()),spawn.hut(4,15,t()),spawn.hut(24,24,t()),spawn.hut(42,9,t()),spawn.hut(51,15,t()),spawn.hut(28,33,t()),spawn.hut(45,3,t()),spawn.hut(23,33,t()),spawn.soldier(35,16),spawn.soldier(37,16),spawn.archer(36,16),spawn.archer(38,16),spawn.peasant(39,16),spawn.priest(40,16),spawn.orc(12,25),spawn.orc(13,25),spawn.orc(14,25),spawn.orc(24,18);for(var u=[24,22,24,16,42,7,48,55,37],v=[18,25,5,34,4,9,4,28,31],w=0;w<u.length;w++)this.game.math.chanceRoll(75)&&(this.game.math.chanceRoll(25)?spawn.orcParty(u[w],v[w]):spawn.orc(u[w],v[w]));b.add.existing(k),b.add.existing(m),b.add.existing(l),s.attach(),o.forEach(s.track,s);var x=this.lasso=new Lasso(b,o);b.add.existing(x),e.events.onInputDown.add(x.onInputDown,x),e.events.onInputUp.add(x.onInputUp,x),j.events.onStartCommand.add(x.onStartCommand,x),j.events.onEndCommand.add(x.onEndCommand,x),x.events.onLasso.add(i.onLasso,i),b.world.bringToTop(h),b.world.bringToTop(r),this.keys={up:d.addKey(Phaser.Keyboard.UP),down:d.addKey(Phaser.Keyboard.DOWN),left:d.addKey(Phaser.Keyboard.LEFT),right:d.addKey(Phaser.Keyboard.RIGHT),W:d.addKey(Phaser.Keyboard.W),A:d.addKey(Phaser.Keyboard.A),S:d.addKey(Phaser.Keyboard.S),D:d.addKey(Phaser.Keyboard.D)},b.camera.x=800,b.camera.y=222,this.fadeIn(this.FADE_IN_DURATION)},update:function(){var a=this.keys,b=(this.rules,this.humans),c=this.orcs,d=this.arrows,e=this.spells,f=this.game.physics;a.left.isDown||a.A.isDown?this.camera.x-=this.CAMERA_SPEED:(a.right.isDown||a.D.isDown)&&(this.camera.x+=this.CAMERA_SPEED),a.down.isDown||a.S.isDown?this.camera.y+=this.CAMERA_SPEED:(a.up.isDown||a.W.isDown)&&(this.camera.y-=this.CAMERA_SPEED),f.arcade.collide(b,this.layer),f.arcade.collide(c,this.layer),f.arcade.collide(d,this.layer,Arrow.collideWorld,Arrow.processWorld),f.arcade.overlap(d,c,Arrow.collideOrc),f.arcade.collide(b,b),f.arcade.collide(c,c),f.arcade.overlap(e,c,GravityField.changeGravity),f.arcade.overlap(e,b,GravityField.changeGravity),b.callAll("think"),c.callAll("think"),this.fog.update(),this.commands.update(),this.rules.update()},onVictory:function(a){this.fadeOut(this.FADE_OUT_DURATION,this.FADE_OUT_DELAY).onComplete.addOnce(function(){this.game.victory(a)},this)},onDefeat:function(){this.fadeOut(this.FADE_OUT_DURATION,this.FADE_OUT_DELAY).onComplete.addOnce(function(){this.game.defeat()},this)}}),a.Mission=b}(this),function(a){function b(){FadingState.call(this)}b.prototype=Object.create(FadingState.prototype),b.prototype.constructor=b,_.extend(b.prototype,{init:function(a){this.score=a||0},create:function(){this.stage.backgroundColor="#000000",this.game.add.bitmapText(25,25,"minecraftia","The Orcs have Fallen!\nYou Win",24);var a=this.game.add.bitmapText(320,425,"minecraftia","Click to Continue",17),b=game.add.image(385,315,"peasants-icon");b.anchor.setTo(.5,.5),game.add.bitmapText(408,320,"minecraftia","x",16),game.add.bitmapText(421,312,"minecraftia",""+this.score||0,24),this.fadeIn(2500).onComplete.add(function(){this.ready=!0},this),this.ready=!1,this.clicked=!1,this.input.onDown.add(function(){this.clicked=!0,a.destroy()},this)},update:function(){this.clicked&&this.ready&&(this.clicked=!1,this.fadeOut(2e3,300).onComplete.add(this.game.mainMenu,this.game))}}),a.Victory=b}(this),function(a){function b(){FadingState.call(this)}b.prototype=Object.create(FadingState.prototype),b.prototype.constructor=b,_.extend(b.prototype,{create:function(){this.stage.backgroundColor="#000000",this.game.add.bitmapText(25,25,"minecraftia","The Orcs have Risen!\nGame Over",24);var a=this.game.add.bitmapText(325,425,"minecraftia","Click to Continue",17);this.fadeIn(2500).onComplete.add(function(){this.ready=!0},this),this.ready=!1,this.clicked=!1,this.input.onDown.add(function(){this.clicked=!0,a.destroy()},this)},update:function(){this.clicked&&this.ready&&(this.clicked=!1,this.fadeOut(2e3,300).onComplete.add(this.game.mainMenu,this.game))}}),a.Defeat=b}(this),function(a){function b(){Phaser.Game.apply(this,arguments);var a=this.state;a.add("boot",Boot),a.add("preloader",Preloader),a.add("menu",MainMenu),a.add("mission",Mission),a.add("defeat",Defeat),a.add("victory",Victory),a.start("boot"),this.resetProgress()}missions=["test-map-0"],b.prototype=Object.create(Phaser.Game.prototype),b.prototype.constructor=b,_.extend(b.prototype,{mainMenu:function(){this.resetProgress(),this.state.start("menu")},resetProgress:function(){this.currentMission=0},nextMission:function(){var a=this.currentMission||0;a<missions.length&&(this.state.start("mission",!0,!1,missions[a]),a++),this.currenMission=a},defeat:function(){this.state.start("defeat")},victory:function(a){this.state.start("victory",!0,!1,a)}}),a.OrcsGame=b}(this);var game=new OrcsGame(800,600,Phaser.AUTO,"game-container");